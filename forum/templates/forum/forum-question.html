{% load static %}

<!doctype html>
<html lang="en">

<head>
  <title>Forum Question - JurisJunction</title>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">


  <!-- Bootstrap CSS v5.2.1 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-iYQeCzEYFbKjA/T2uDLTpkwGzCiq6soy8tYaI1GyVh/UjpbCx/TYkiZhlZB6+fzT" crossorigin="anonymous">

    <link rel="stylesheet" type="text/css" href="{% static 'css/forum-question-styles.css' %}"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&display=swap">

</head>

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-YM1GGXVM19"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-YM1GGXVM19');
</script>

<div id="question" data-pk="{{ question.pk }}"></div>

<body>
  {% for message in messages %}
  <div class="alert {{ message.tags }} alert-dismissible fade show message-box" role="alert">
    {{ message }}
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
  </div>
  {% endfor %}
  {% include 'navbar.html' %}

      <div class="header-and-back-button">
          <div class="header-box">
            <div class="header-text-and-breadcrumbs">
                <nav class="breadcrumb-nav" style="--bs-breadcrumb-divider: url(&#34;data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='8' height='8'%3E%3Cpath d='M2.5 0L1 1.5 3.5 4 1 6.5 2.5 8l4-4-4-4z' fill='white'/%3E%3C/svg%3E&#34;);" aria-label="breadcrumb">
                    <ol class="breadcrumb">
                      <li class="breadcrumb-item"><a href="{% url 'forum_home' %}">Forum Home</a></li>

                    {% if keyword != "None" and keyword is not None %}
                    <li class="breadcrumb-item"><a href="{% url 'forum_search_results' %}?keyword_search={{ keyword }}">Search Results</a></li>
                    {% endif %}
                    {% if topic != "None" and topic is not None %}
                    <li class="breadcrumb-item"><a href="{% url 'forum_search_results' %}?topic={{ topic }}">Search Results</a></li>
                    {% endif %}
                    {% if province != "None" and province is not None %}
                    <li class="breadcrumb-item"><a href="{% url 'forum_search_results' %}?province={{ province }}">Search Results</a></li>
                    {% endif %}
                      <li class="breadcrumb-item active" aria-current="page">Question</li>
                    </ol>
                  </nav>
                <h1>JurisJunction Forum</h1>
                <h5>Expert advise from certified accountants.</h5>
            </div>
          </div>
      </div>
      

    <div class="card shadow question-card">
        <div class="card-content">
            <div class="title-and-topics">
                <h3 class="card-title">{{ question.forum_question_title }}</h3>
                <div class="tags">
                    <div class="all-topics">
                        <div class="topic-title-and-tags">
                            <div class="tags-title"><b>Tags</b></div>
                            <div class="tags-container">
                                {% for topic in question.topics.all %}
                                <a href="{% url 'forum_search_results' %}?topic={{ topic }}">
                                    <div class="topic">{{ topic }}</div>
                                </a>
                            {% endfor %}
                            </div>
                        </div>
                    </div>
                    <div class="location">
                        <b>Location</b>
                        <a href="{% url 'forum_search_results' %}?province={{ question.location }}">
                        <div class="topic">{{ question.location }}</div>
                        </a>
                    </div>
                </div>
            </div>
            <hr>
            <p class="card-text">{{ question.forum_question}}</p>
        </div>
        <div class="status-and-date">
          {% if question.resolved_status %}
          <div class="status" style="border-color:#08ec00; background-color: #00ec1c7e;">
            <p>Resolved</p>
          </div>
            {% else %}
            <div class="status" style="border-color:#e30202; background-color: #ec00007e;">
              <p>Un-resolved</p>
            </div>
            {%endif%}
          <div class="date">
            <small>Asked on: {{question.created_at}}</small>
          </div>
        </div>
    </div>

    {% if not request.user.is_authenticated %}
    <div class="ask-question">
      <h3>Have your own question? Ask <a href="{% url 'forum_ask' %}">here</a>.</h3>
    </div>
    <div class="reply-count-text">
        {% if num_of_reviews == 1 %}
            <h3><b>{{ num_of_reviews }} Reply</b></h3>
        {% else %}
            <h3><b>{{ num_of_reviews }} Replies</b></h3>
        {% endif %}
    </div>

    {% else %}
      <form class="answer-form" id="answerForm" method="POST">
        {% csrf_token %}
        <div class="mb-5 user-answer">
          <div class="answer-card-content">
            <label for="answerCardText" class="form-label">Reply as {{user.professional.first_name}} {{user.professional.last_name}}:</label>
            <textarea class="form-control" id="answerCardText" rows="5" placeholder="Start your reply..." required></textarea>
          </div>
          <div class="submit-button-container">
            <button type="submit" class="btn btn-primary submit-button" id="submitButton">Post Answer</button>
        </div>
        </div>
      </form>
    {% endif %}


    {% if answers %}
        {% for answer in answers %}
    <div class="card shadow-sm answer-card">
      <a href="{% url 'professional_page' unique_id=answer.professional_answered.unique_id %}" style="text-decoration: none; color:black">
        <div class="name-and-pfp">
            <img src="{{ answer.professional_answered.profile_picture.url }}"> 
            <div class="pro-desc">
                <div class="name-and-cert">
                    <h3 class="name-text"> {{ answer.professional_answered.first_name }} {{ answer.professional_answered.last_name }}</h3>
                    <div class="cert">
                        <small class="jur-small"><i>JurisCertified&copy;</i></small>
                        <i class="bi bi-question-circle-fill" data-bs-toggle="tooltip" data-bs-placement="right" title="This Accountant has been vetted by the JurisJunction team."></i>
                    </div>
                </div>
                <p>
                    Specializes in 
                    {% for specialty in answer.professional_answered.specialties.all|slice:":2" %}
                        {{ specialty.specialty }}{% if not forloop.last %}, {% endif %}
                    {% endfor %}
                    {% if answer.professional_answered.specialties.count > 2 %}
                        and {{ answer.professional_answered.specialties.count|add:"-2" }} more
                    {% endif %}
                </p>
                {% if answer.professional_answered.average_rating %}
                <div class="rating-and-reviews">
                  <p>{{ answer.professional_answered.average_rating }}/5.0 Rating</p>
                  <p class="review-count">
                    {% if answer.professional_answered.num_of_reviews == 1 %}
                    {{ answer.professional_answered.num_of_reviews }} Review
                    {% else %}
                    {{ answer.professional_answered.num_of_reviews }} Reviews
                    {% endif %}
                  </p>
                </div>
                {% else %}
                <p>No reviews yet.</p>
                {% endif %}
            </div>
        </div>
      </a>
        <hr style="margin-left:30px; margin-right:30px;">
        <div class="answer-text">
          <p>{{ answer.response }}</p>
        </div>
    </div>
        {% endfor %}

    {% else %}
    <div class="no-answer">
        <h3>No answers yet.</h3>
    </div>
    {% endif %}

    {% include 'footer.html' %}
  <!-- Bootstrap JavaScript Libraries -->
  
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"
    integrity="sha384-oBqDVmMz9ATKxIep9tiCxS/Z9fNfEXiDAYTujMAeBAsjFuCZSmKbSSUnQlmh/jp3" crossorigin="anonymous">
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/js/bootstrap.min.js"
    integrity="sha384-7VPbUDkoPSGFnVtYi0QogXtr74QeVeeIs99Qfg5YCF+TidwNdjvaKZX19NZ/e6oz" crossorigin="anonymous">
  </script>

  <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
  <script src="{% static 'js/forumQuestion.js' %}"></script>


<script>
    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
    var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
      return new bootstrap.Tooltip(tooltipTriggerEl)
    })
  </script>
  </div>
</body>

</html>